var f=Object.defineProperty,_=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var u=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var b=(e,i,t)=>i in e?f(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,V=(e,i)=>{for(var t in i||(i={}))E.call(i,t)&&b(e,t,i[t]);if(u)for(var t of u(i))F.call(i,t)&&b(e,t,i[t]);return e},w=(e,i)=>_(e,L(i));import{an as n,a as h,dm as C,n as g,cK as O,ae as y,dn as p,cV as R,w as m}from"./vendor.c414a8c9.js";import{b as x}from"./WGLContainer.400ca512.js";import{L as T}from"./enums.de935fa5.js";import{u as B,f as S}from"./LayerView.da2fde64.js";import"./pixelUtils.8244b2be.js";import"./utils.26cfa974.js";import"./Utils.d29fb889.js";import"./enums.6e42a319.js";import"./Texture.21608732.js";import"./VertexElementDescriptor.d386088d.js";import"./MaterialKey.003e1aef.js";import"./VertexArrayObject.6089921b.js";import"./ProgramTemplate.443da894.js";import"./StyleDefinition.627ffe6c.js";import"./config.40d47db8.js";import"./GeometryUtils.8166011b.js";import"./earcut.d30cbec0.js";class A extends x{constructor(){super(...arguments),this.requiresDedicatedFBO=!1}dispose(){}doRender(i){const t=this.createRenderParams(i),{context:r,painter:s,profiler:o}=t;this._prevFBO=r.getBoundFramebufferObject(),o.recordContainerStart(this.name);const d=this._getFbo(t),v=s.getRenderTarget();r.bindFramebuffer(d),s.setRenderTarget(d),r.setDepthWriteEnabled(!0),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.setClearDepth(1),r.clear(r.gl.COLOR_BUFFER_BIT|r.gl.DEPTH_BUFFER_BIT),r.setDepthWriteEnabled(!1);for(const l of this.children)l.beforeRender(i);for(const l of this.children)l.processRender(t);for(const l of this.children)l.afterRender(i);s.setRenderTarget(v),s.releaseFbo(d),r.bindFramebuffer(this._prevFBO),s.beforeRenderLayer(t,this._clippingInfos?255:0,this.computedOpacity),r.setStencilTestEnabled(!1),r.setStencilWriteMask(0),s.blitTexture(r,d.colorTexture,T.NEAREST),s.compositeLayer(t,this.computedOpacity),o.recordContainerEnd()}createRenderParams(i){return w(V({},super.createRenderParams(i)),{blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:1})}_getFbo(i){const{context:t,painter:r}=i,{width:s,height:o}=t.getViewport();return r.acquireFbo(s,o)}}let a=class extends B{constructor(e){super(e),this.type="group",this.layerViews=new O}_allLayerViewVisibility(e){this.layerViews.forEach(i=>{i.visible=e})}initialize(){this.handles.add([this.layerViews.on("change",e=>this._layerViewsChangeHandler(e)),y(()=>this.layer.visibilityMode,()=>this._applyVisibility(()=>this._allLayerViewVisibility(this.visible),()=>this._applyExclusiveVisibility(null)),p),y(()=>this.visible,e=>{this._applyVisibility(()=>this._allLayerViewVisibility(e),()=>{})},p)],"grouplayerview"),this._layerViewsChangeHandler({target:null,added:this.layerViews.toArray(),removed:[],moved:[]})}set layerViews(e){this._set("layerViews",R(e,this._get("layerViews")))}get updatingProgress(){return this.layerViews.length===0?1:this.layerViews.reduce((e,i)=>e+i.updatingProgress,0)/this.layerViews.length}isUpdating(){return this.layerViews.some(e=>e.updating)}_hasLayerViewVisibleOverrides(){return this.layerViews.some(e=>e._isOverridden("visible"))}_findLayerViewForLayer(e){return e&&this.layerViews.find(i=>i.layer===e)}_firstVisibleOnLayerOrder(){const e=this.layer.layers.find(i=>{var t;return(t=this._findLayerViewForLayer(i))==null?void 0:t.visible});return e&&this._findLayerViewForLayer(e)}_applyExclusiveVisibility(e){m(e)&&(e=this._firstVisibleOnLayerOrder(),m(e)&&this.layerViews.length>0&&(e=this._findLayerViewForLayer(this.layer.layers.getItemAt(0)))),this.layerViews.forEach(i=>{i.visible=i===e})}_layerViewsChangeHandler(e){this.handles.remove("grouplayerview:visible"),this.handles.add(this.layerViews.map(t=>y(()=>t.visible,r=>this._applyVisibility(()=>{r!==this.visible&&(t.visible=this.visible)},()=>this._applyExclusiveVisibility(r?t:null)),p)).toArray(),"grouplayerview:visible");const i=e.added[e.added.length-1];this._applyVisibility(()=>this._allLayerViewVisibility(this.visible),()=>this._applyExclusiveVisibility((i==null?void 0:i.visible)?i:null))}_applyVisibility(e,i){var t,r;this._hasLayerViewVisibleOverrides()&&(((t=this.layer)==null?void 0:t.visibilityMode)==="inherited"?e():((r=this.layer)==null?void 0:r.visibilityMode)==="exclusive"&&i())}};n([h({cast:C})],a.prototype,"layerViews",null),n([h({readOnly:!0})],a.prototype,"updatingProgress",null),n([h()],a.prototype,"view",void 0),a=n([g("esri.views.layers.GroupLayerView")],a);const M=a;let c=class extends S(M){constructor(){super(...arguments),this.container=new A}attach(){this._updateStageChildren(),this.handles.add(this.layerViews.on("after-changes",()=>this._updateStageChildren()),"grouplayerview2d")}detach(){this.handles.remove("grouplayerview2d"),this.container.removeAllChildren()}update(e){}moveStart(){}viewChange(){}moveEnd(){}_updateStageChildren(){this.container.removeAllChildren(),this.layerViews.forEach((e,i)=>this.container.addChildAt(e.container,i))}};c=n([g("esri.views.2d.layers.GroupLayerView2D")],c);const Z=c;export{Z as default};
