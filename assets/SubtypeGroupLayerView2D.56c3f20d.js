var m=Object.defineProperty,u=Object.defineProperties;var d=Object.getOwnPropertyDescriptors;var n=Object.getOwnPropertySymbols;var h=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable;var p=(r,e,i)=>e in r?m(r,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[e]=i,l=(r,e)=>{for(var i in e||(e={}))h.call(e,i)&&p(r,i,e[i]);if(n)for(var i of n(e))b.call(e,i)&&p(r,i,e[i]);return r},y=(r,e)=>u(r,d(e));import{an as c,n as f,ae as g,af as w,r as $,d2 as x}from"./vendor.c414a8c9.js";import S from"./FeatureLayerView2D.1ba52a99.js";import"./utils.26cfa974.js";import"./Utils.d29fb889.js";import"./enums.6e42a319.js";import"./enums.de935fa5.js";import"./Texture.21608732.js";import"./VertexElementDescriptor.d386088d.js";import"./MaterialKey.003e1aef.js";import"./LayerView.da2fde64.js";import"./schemaUtils.48f0e3c8.js";import"./visualVariablesUtils.f6ff214d.js";import"./createSymbolSchema.7c9fbeea.js";import"./CIMSymbolHelper.cef2d21f.js";import"./BidiEngine.ec67919b.js";import"./GeometryUtils.814cb798.js";import"./ExpandedCIM.13be576b.js";import"./quantizationUtils.2450b4c7.js";import"./MD5.97b39efc.js";import"./util.dfab6411.js";import"./floorFilterUtils.69500d62.js";import"./popupUtils.79cbcb0c.js";import"./RefreshableLayerView.909741ab.js";function v(r,e){return!r.visible||r.minScale!==0&&e>r.minScale||r.maxScale!==0&&e<r.maxScale}let o=class extends S{initialize(){this.handles.add([g(()=>{var r;return(r=this.view)==null?void 0:r.viewpoint},()=>this._update(),w)])}_injectOverrides(r){let e=super._injectOverrides(r);const i=this.view.scale,s=this.layer.sublayers.filter(a=>v(a,i)).map(a=>a.subtypeCode);if(!s.length)return e;e=$(e)?e:new x().toJSON();const t=`NOT ${this.layer.subtypeField} IN (${s.join(",")})`;return e.where=e.where?`(${e.where}) AND (${t})`:t,e}_setLayersForFeature(r){const e=this.layer.fieldsIndex.get(this.layer.subtypeField),i=r.attributes[e.name],s=this.layer.sublayers.find(t=>t.subtypeCode===i);r.layer=s,r.sourceLayer=this.layer}_createSchemaConfig(){const r={subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers).map(t=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfo:t.labelingInfo,labelsVisible:t.labelsVisible,renderer:t.renderer,subtypeCode:t.subtypeCode,orderBy:null}))},e=this.layer.sublayers.map(t=>t.subtypeCode).join(","),i=this.layer.sublayers.length?`${this.layer.subtypeField} IN (${e})`:"1=2";let s=this.layer.definitionExpression?this.layer.definitionExpression+" AND ":"";return s+=i,y(l(l({},super._createSchemaConfig()),r),{definitionExpression:s})}};o=c([f("esri.views.2d.layers.SubtypeGroupLayerView2D")],o);const Q=o;export{Q as default};
