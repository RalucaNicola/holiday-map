var Ee=Object.defineProperty,ze=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var ne=Object.getOwnPropertySymbols;var Ie=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var le=(e,i,t)=>i in e?Ee(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,v=(e,i)=>{for(var t in i||(i={}))Ie.call(i,t)&&le(e,t,i[t]);if(ne)for(var t of ne(i))$e.call(i,t)&&le(e,t,i[t]);return e},h=(e,i)=>ze(e,Ve(i));import{s as Z,B as O,b1 as K,C as d,bQ as ae,an as G,a as Me,c5 as Oe,n as Le,c6 as ce,c7 as oe,bf as de,w as A,c8 as R,r as z,c9 as Ce,E as H,W as ue,a9 as Ne}from"./vendor.c414a8c9.js";import{l as k,S as w,r as _e}from"./Utils.d29fb889.js";import{c as Re}from"./utils.26cfa974.js";import{o as Be}from"./visualVariablesUtils.f6ff214d.js";import{createSymbolSchema as x}from"./createSymbolSchema.7c9fbeea.js";import{t as ke}from"./CIMSymbolHelper.cef2d21f.js";import{a5 as De}from"./enums.6e42a319.js";import"./MaterialKey.003e1aef.js";import"./ExpandedCIM.13be576b.js";import{x as ee}from"./MD5.97b39efc.js";import{e as ye}from"./util.dfab6411.js";function Pe(e){if(!e)return k.NONE;let i=0;for(const t of e)if(t.type==="size"){const s=Be(t);i|=s,t.target==="outline"&&(i|=s<<4)}else t.type==="color"?i|=k.COLOR:t.type==="opacity"?i|=k.OPACITY:t.type==="rotation"&&(i|=k.ROTATION);return i}function Ue(e){if(!("visualVariables"in e)||!e.hasVisualVariables("size"))return 0;const i=e.getVisualVariablesForType("size");if(!i[0])return 0;const t=i[0];if(t.target==="outline")return 0;if(t.transformationType==="stops")return t.stops.map(s=>s.size).reduce(J,0);if(t.transformationType==="clamped-linear"){let s=-1/0,r=-1/0;return s=typeof t.maxSize=="number"?t.maxSize:t.maxSize.stops.map(n=>n.size).reduce(J,0),r=typeof t.minSize=="number"?t.minSize:t.minSize.stops.map(n=>n.size).reduce(J,0),Math.max(s,r)}return t.transformationType==="real-world-size"?30:void 0}De.metrics,new ke(0,0,24,24);function J(e,i){return Math.max(e,i)}const P=8,me=P-2,U=Z.getLogger("esri.views.2d.layers.features.support.rendererUtils"),Mt=e=>{if(!("visualVariables"in e)||!e.visualVariables||!e.visualVariables.length)return e;const i=e.clone(),t=i.visualVariables.map(s=>ge(s)?be(s):s);return i.visualVariables=t,i};function Ae(e){return e.map(i=>ge(i)?be(i.clone()):i)}function ge(e){return(e.type==="size"||e.type==="color"||e.type==="opacity")&&e.stops!=null}function be(e){return e.stops=He(e.type,e.stops),e}function I(e,i,t){return(1-t)*e+t*i}function qe(e,i){const[t,...s]=i,r=s.pop(),n=s[0].value,a=s[s.length-1].value,l=(a-n)/me,u=[];for(let o=n;o<a;o+=l){let p=0;for(;o>=s[p].value;)p++;const m=s[p],f=i[p-1],L=o-f.value,F=m.value===f.value?1:L/(m.value-f.value);if(e==="color"){const c=s[p],g=i[p-1],y=c.color.clone();y.r=I(g.color.r,y.r,F),y.g=I(g.color.g,y.g,F),y.b=I(g.color.b,y.b,F),y.a=I(g.color.a,y.a,F),u.push({value:o,color:y,label:c.label})}else if(e==="size"){const c=s[p],g=i[p-1],y=ae(c.size),q=I(ae(g.size),y,F);u.push({value:o,size:q,label:c.label})}else{const c=s[p],g=I(i[p-1].opacity,c.opacity,F);u.push({value:o,opacity:g,label:c.label})}}return[t,...u,r]}function Ge(e){const[i,...t]=e,s=t.pop();for(;t.length>me;){let r=0,n=0;for(let a=1;a<t.length;a++){const l=t[a-1],u=t[a],o=Math.abs(u.value-l.value);o>n&&(n=o,r=a)}t.splice(r,1)}return[i,...t,s]}function He(e,i){return i.length<=P?i:(U.warn(`Found ${i.length} Visual Variable stops, but MapView only supports ${P}. Displayed stops will be simplified.`),i.length>2*P?qe(e,i):Ge(i))}function te(){if(O("heatmap-force-raster"))return"raster";const{supportsTextureFloat:e,supportsTextureHalfFloat:i,supportsColorBufferFloat:t,supportsColorBufferFloatBlend:s,supportsColorBufferHalfFloat:r}=K("2d");return e&&t&&s||i&&r?"symbol":O("heatmap-allow-raster-fallback")?"raster":"none"}function Ot(e){if(!e)return!0;switch(e.type){case"dot-density":if(!K("2d").supportsTextureFloat)return U.error(new d("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),!1;break;case"heatmap":{const i=te();if(i==="none"||i==="raster"&&!O("heatmap-force-raster")){const t=K("2d"),s=["supportsTextureFloat","supportsTextureHalfFloat","supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(r=>!t[r]).join(", ");if(i==="none")return U.errorOnce(new d("webgl-missing-extension",`Missing WebGL${t.type} requirements for Heatmap: ${s}`)),!1;i==="raster"&&U.warnOnce(`Missing WebGL${t.type} requirements for accelerated Heatmap: ${s}. Feature support may be limited.`)}break}}return!0}var Q;let B=Q=class extends ce{writeLevels(e,i,t){for(const s in e){const r=this.levels[s];return void(i.stops=r)}}clone(){return new Q({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:oe(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:oe(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:de(this.levels)})}};G([Me()],B.prototype,"levels",void 0),G([Oe("levels")],B.prototype,"writeLevels",null),B=Q=G([Le("esri.views.2d.engine.LevelDependentSizeVariable")],B);const ve=Z.getLogger("esri.views.2d.layers.support.clusterUtils");O.add("esri-cluster-arcade-enabled",!0);const Je=O("esri-cluster-arcade-enabled"),We=(e,i,t,s)=>{const r=i.clone();if(!Qe(r))return r;if(t.fields)for(const n of t.fields)xe(e,n);if("visualVariables"in r){const n=(r.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=je(n);n.forEach(l=>{l.type==="rotation"?l.field?l.field=$(e,l.field,"avg_angle"):l.valueExpression&&(l.field=D(e,l.valueExpression,"avg_angle"),l.valueExpression=null):l.normalizationField?(l.field=$(e,l.field,"norm",l.normalizationField),l.normalizationField=null):l.field?l.field=$(e,l.field,"avg"):(l.field=D(e,l.valueExpression,"avg"),l.valueExpression=null)}),A(a)&&!Ye(n)&&(n.push(Ke(t,s)),r.dynamicClusterSize=!0),r.visualVariables=n}switch(r.type){case"simple":break;case"unique-value":r.field?r.field=$(e,r.field,"mode"):r.valueExpression&&(r.field=D(e,r.valueExpression,"mode"),r.valueExpression=null);break;case"class-breaks":r.normalizationField?(r.field=$(e,r.field,"norm",r.normalizationField),r.normalizationField=null):r.field?r.field=$(e,r.field,"avg"):(r.field=D(e,r.valueExpression,"avg"),r.valueExpression=null)}return r},je=e=>{for(const i of e)if(i.type==="size")return i;return null},Ye=e=>{for(const i of e)if(i.field==="cluster_count")return!0;return!1},Ke=(e,i)=>{const t=[new R({value:0,size:0}),new R({value:1})];if(A(i))return new ce({field:"cluster_count",stops:[...t,new R({value:2,size:0})]});const s=Object.keys(i).reduce((r,n)=>h(v({},r),{[n]:[...t,new R({value:Math.max(2,i[n].minValue),size:e.clusterMinSize}),new R({value:Math.max(3,i[n].maxValue),size:e.clusterMaxSize})]}),{});return new B({field:"cluster_count",levels:s})},Qe=e=>{const i=t=>ve.error(new d("Unsupported-renderer",t,{renderer:e}));if(e.type==="unique-value"){if(e.field2||e.field3)return i("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1}else if(e.type==="class-breaks"){if(e.normalizationField){const t=e.normalizationType;if(t!=="field")return i(`FeatureReductionCluster does not support a normalizationType of ${t}`),!1}}else if(e.type!=="simple")return i(`FeatureReductionCluster does not support renderers of type ${e.type}`),!1;if(!Je){if("valueExpression"in e&&e.valueExpression)return i("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in e&&e.visualVariables||[]).some(t=>!(!("valueExpression"in t)||!t.valueExpression)))return i("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function Xe(e,i,t){switch(e){case"avg":case"avg_angle":return`cluster_avg_${i}`;case"mode":return`cluster_type_${i}`;case"norm":{const s=t,r="field",n=i.toLowerCase()+",norm:"+r+","+s.toLowerCase();return"cluster_avg_"+ee(n)}}}function xe(e,i){const{name:t,outStatistic:s}=i,{onStatisticField:r,onStatisticValueExpression:n,statisticType:a}=s;if(n){const l=ee(n.toLowerCase());e.push({name:t,outStatistic:{onStatisticField:l,onStatisticValueExpression:n,statisticType:a}})}else r?e.push({name:t,outStatistic:{onStatisticField:r,statisticType:a}}):ve.error(new d("mapview-unsupported-field","Unable to handle field",{field:i}))}function D(e,i,t){const s=ee(i),r=t==="mode"?`cluster_type_${s}`:`cluster_avg_${s}`;return e.some(n=>n.name===r)||e.push({name:r,outStatistic:{onStatisticField:s,onStatisticValueExpression:i,statisticType:t}}),r}function $(e,i,t,s){if(i==="cluster_count"||e.some(n=>n.name===i))return i;const r=Xe(t,i,s);return e.some(n=>n.name===r)||(t==="norm"?e.push({name:r,outStatistic:{onStatisticField:i,onStatisticNormalizationField:s,statisticType:t}}):e.push({name:r,outStatistic:{onStatisticField:i,statisticType:t}})),r}const M=Z.getLogger("esri.views.2d.layers.features.schemaUtils"),b="ValidationError",Ze={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function E(e){let i=0,t=0,s=w.DEFAULT;if(z(e)){if(t=Ue(e),"visualVariables"in e&&(i=Pe(e.visualVariables||[]),e.type==="dot-density"&&(s=w.DOT_DENSITY)),e.type==="heatmap"&&(s=w.HEATMAP),e.type==="dictionary")return{maxVVSize:t,vvFlags:i,symbologyType:w.DEFAULT};if(e.type==="pie-chart")return{maxVVSize:t,vvFlags:i,symbologyType:w.PIE_CHART};if(s!==w.DOT_DENSITY&&s!==w.HEATMAP){const r=e.getSymbols();"backgroundFillSymbol"in e&&e.backgroundFillSymbol&&r.push(e.backgroundFillSymbol);let n=!0,a=!0;for(const l of r)if(l.type==="cim"&&(a=!1),l.type==="simple-fill"||l.type==="picture-fill"){const u=l.outline,o=u&&u.style!=="none"&&u.style!=="solid",p=l.type==="simple-fill"&&l.style!=="none"&&l.style!=="solid",m=l.type==="picture-fill"||p||o;o&&(n=!1),m&&(a=!1)}n?s=a?w.OUTLINE_FILL_SIMPLE:w.OUTLINE_FILL:a&&(s=w.SIMPLE)}}return{vvFlags:i,maxVVSize:t,symbologyType:s}}function et(e,i){const t=e.labelPlacement,s=Ze[i];if(!e.symbol)return M.warn("No ILabelClass symbol specified."),!0;if(!s)return M.error(new d("mapview-labeling:unsupported-geometry-type",`Unable to create labels for Feature Layer, ${i} is not supported`)),!0;if(!s.includes(t)){const r=s[0];t&&M.warn(`Found invalid label placement type ${t} for ${i}. Defaulting to ${r}`),e.labelPlacement=r}return!1}function he(e,i){const t=de(e);return t.some(s=>et(s,i))?[]:t}function Lt(e){return O("esri-2d-update-debug")&&console.debug("Created new schema",pe(e,!0)),pe(e)}function pe(e,i=!1){var t,s;try{const r=rt(e,i),n=at(e),a={};r.map(o=>tt(a,e,o));const l=z(e.subtypeCode)?`${e.subtypeField} = ${e.subtypeCode}`:null;return{source:{definitionExpression:Ce(e.definitionExpression,l),fields:e.fields.map(o=>o.toJSON()),gdbVersion:e.gdbVersion,historicMoment:(t=e.historicMoment)==null?void 0:t.getTime(),outFields:e.availableFields,pixelBuffer:e.pixelBuffer,spatialReference:e.spatialReference.toJSON(),timeExtent:(s=e.timeExtent)==null?void 0:s.toJSON(),customParameters:e.customParameters},attributes:{fields:{},indexCount:0},processors:r,tileRenderer:n,targets:a}}catch(r){if(r.fieldName===b)return M.error(r),null;throw r}}function tt(e,i,t){switch(t.target){case"feature":return void j(e,W(i),t);case"aggregate":{if(!("featureReduction"in i))return;const s=i.featureReduction;switch(s.type){case"selection":throw new d(b,"Mapview does not support `selection` reduction type",s);case"binning":return j(e,W(i),t),void it(e,s,t);case"cluster":return j(e,W(i),t),void st(e,s,t)}}}}function ie(e,i){for(const t in i){const s=i[t];if(s.target!==e.name)continue;const r=e.attributes[t];r?(r.context.mesh=r.context.mesh||s.context.mesh,r.context.storage=r.context.storage||s.context.storage):e.attributes[t]=s}return e}function W(e){var i,t,s,r,n;return[(t=(i=H(e.filter))==null?void 0:i.toJSON())!=null?t:null,(n=(r=H((s=H(e.featureEffect))==null?void 0:s.filter))==null?void 0:r.toJSON())!=null?n:null]}function j(e,i,t){return e.feature||(e.feature={name:"feature",input:"source",filters:i,attributes:{}}),ie(e.feature,t.attributes.fields),e}function it(e,i,t){return e.aggregate||(e.aggregate={name:"aggregate",type:"bin",filters:null,input:"feature",params:{fixedBinLevel:i.fixedBinLevel},attributes:{}}),ie(e.aggregate,t.attributes.fields),e}function st(e,i,t){return e.aggregate||(e.aggregate={name:"aggregate",type:"cluster",input:"feature",filters:null,attributes:{},params:{clusterRadius:ue(i.clusterRadius/2),clusterPixelBuffer:64*Math.ceil(ue(i.clusterMaxSize)/64),fields:t.aggregateFields}}),ie(e.aggregate,t.attributes.fields),e}function S(e,i){return i.field?T(e,h(v({},i),{type:"field",field:i.field})):i.valueExpression?T(e,h(v({},i),{type:"expression",valueExpression:i.valueExpression})):{field:null,fieldIndex:null}}function T(e,i){switch(i.type){case"expression":{const t=i.valueExpression;if(!e.fields[t]){const s=e.indexCount++;e.fields[t]=h(v({},i),{name:t,fieldIndex:s})}return{fieldIndex:e.fields[t].fieldIndex}}case"label-expression":{const t=JSON.stringify(i.label);if(!e.fields[t]){const s=e.indexCount++;e.fields[t]=h(v({},i),{name:t,fieldIndex:s})}return{fieldIndex:e.fields[t].fieldIndex}}case"field":{const t=i.field;return i.target==="aggregate"&&e.fields[t]||(e.fields[t]=h(v({},i),{name:t})),{field:t}}case"statistic":return e.fields[i.name]=v({},i),{field:i.name}}}function rt(e,i=!1){const t=new Array;let s=0;return t.push(lt(e,s++,i)),t}function Y(e,i,t,s,r,n=!1){const a=T(i,{type:"label-expression",target:s,context:{mesh:!0},resultType:"string",label:{labelExpression:t.labelExpression,labelExpressionInfo:t.labelExpressionInfo?{expression:t.labelExpressionInfo.expression}:null,symbol:!!t.symbol,where:t.where}}),{fieldIndex:l}=a,u=E(e);return h(v({},x(t,u,n)),{fieldIndex:l,target:s,index:r})}function nt(e,i,t){const s="featureReduction"in i&&i.featureReduction;if(!s)return{fields:[],labels:[],matcher:null,rendererOverride:null};const r="aggregate",n=[];let a=null,l=ye(i.geometryType),u=[],o=null;if(s)switch(s.type){case"selection":throw new d(b,"Mapview does not support `selection` reduction type",s);case"cluster":case"binning":if(s.type==="cluster"?l="esriGeometryPoint":s.type==="binning"&&(l="esriGeometryPolygon"),s.renderer){for(const p of s.fields)xe(n,p);o=s.renderer,a=X(null,r,s.renderer,t),u=s&&s.labelsVisible&&s.labelingInfo||[]}else if(s.type==="cluster"){if(o=We(n,i.renderer,s,null),s.symbol){const p=E(o);a={type:"simple",symbol:x(s.symbol,p,t),symbologyType:p.symbologyType}}u=s&&s.labelsVisible&&s.labelingInfo||[]}}return ut(e,n),{labels:he(u,s.type==="binning"?"esriGeometryPolygon":l),matcher:a,fields:n,rendererOverride:o}}function lt(e,i,t=!1){var F;const s={indexCount:0,fields:{}},r="featureReduction"in e&&e.featureReduction?"aggregate":"feature";if("sublayers"in e){const c={type:"subtype",subtypeField:e.subtypeField,renderers:{},symbologyType:w.DEFAULT},g={type:"subtype",mapping:{},target:"feature"},y={type:"subtype",classes:{}},q={type:"symbol",target:"feature",aggregateFields:[],attributes:s,storage:g,mesh:{matcher:c,aggregateMatcher:null,labels:y,sortKey:null}},se=new Set;let we=0;for(const{renderer:V,subtypeCode:C,labelingInfo:Se,labelsVisible:Fe}of e.sublayers){const N=X(s,r,V,t),_=fe(s,r,V),re=Fe&&Se;if("visualVariables"in V&&V.visualVariables&&V.visualVariables.length)throw new d(b,"Visual variables are currently not supported for subtype layers");if(N.type==="dictionary")throw new d(b,"Dictionary renderer is not supported in subtype layers");if(N.type==="subtype")throw new d(b,"Nested subtype renderers is not supported");if(z(_)&&_.type==="subtype")throw new d(b,"Nested subtype storage is not supported");if(z(_)&&z(_.attributeMapping))throw new d(b,"Non-visual-variable attributes are not supported in subtype layers");if(N.type==="heatmap")throw new d(b,"Heatmaps are not supported in subtype layers");if(N.type==="pie-chart")throw new d(b,"Pie-charts are not supported in subtype layers");if(se.has(C))throw new d(b,"Subtype codes for sublayers must be unique");se.add(C),c.renderers[C]=N,g.mapping[C]=_,re&&(y.classes[C]=re.map(Te=>Y(V,s,Te,"feature",we++,t)))}return q}if(e.renderer.type==="heatmap"&&te()==="raster"){const{radius:c,fieldOffset:g,field:y}=e.renderer;return{type:"heatmap",aggregateFields:[],attributes:s,target:r,storage:null,mesh:{radius:c,fieldOffset:g,field:S(s,{target:r,field:y,resultType:"numeric"}).field}}}const n=nt(s,e,t),a=ye(e.geometryType),l=(F=n.rendererOverride)!=null?F:e.renderer,u=X(s,r,l,t),o=fe(s,r,l),p=ot(s,e.orderBy),m=he(e.labelsVisible&&e.labelingInfo||[],a);let f=0;const L=[...m.map(c=>Y(l,s,c,"feature",f++,t)),...n.labels.map(c=>Y(l,s,c,"aggregate",f++,t))];return{type:"symbol",target:r,attributes:s,aggregateFields:n.fields,storage:o,mesh:{matcher:u,labels:{type:"simple",classes:L},aggregateMatcher:n.matcher,sortKey:p}}}function at(e){var i;return((i=e.renderer)==null?void 0:i.type)==="heatmap"&&te()==="raster"?{type:"heatmap"}:{type:"symbol"}}function ot(e,i){if(A(i)||!i.length)return null;i.length>1&&M.warn(`Layer rendering currently only supports ordering by 1 orderByInfo, but found ${i.length}. All but the first will be discarded`);const t=i[0],s=t.order==="ascending"?"asc":"desc";return t.field?{field:t.field,order:s}:t.valueExpression?{fieldIndex:T(e,{type:"expression",target:"feature",valueExpression:t.valueExpression,resultType:"numeric"}).fieldIndex,order:s}:(M.error(new d(b,"Expected to find a field or valueExpression for OrderByInfo",t)),null)}function ut(e,i){const t={mesh:!0,storage:!0};for(const s of i){const{name:r,outStatistic:n}=s,{statisticType:a,onStatisticField:l}=n;let u=null,o=null,p=null;const m="numeric",f="feature";"onStatisticValueExpression"in n?o=T(e,{type:"expression",target:f,valueExpression:n.onStatisticValueExpression,resultType:m}).fieldIndex:"onStatisticNormalizationField"in n?(u=T(e,{type:"field",target:f,field:l,resultType:m}).field,p=n.onStatisticNormalizationField):u=T(e,{type:"field",target:f,field:l,resultType:m}).field,T(e,{type:"statistic",target:"aggregate",name:r,context:t,inField:u,inNormalizationField:p,inFieldIndex:o,statisticType:a})}}function fe(e,i,t){let s;switch(t.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":s={visualVariables:!0,attributes:null};break;default:s=Re(t).getStorageSpec(t)}return pt(e,i,s,t)}function pt(e,i,t,s){if(A(t))return null;const{visualVariables:r,attributes:n}=t;let a=null;r&&"visualVariables"in s&&(a=ft(e,i,s.visualVariables));const l=z(a)?4:0;let u=null;return z(n)&&(u=n.map((o,p)=>{const{field:m,fieldIndex:f}=S(e,{valueExpression:o.valueExpression,field:o.field,resultType:"numeric",target:i});return{binding:p+l,field:m,fieldIndex:f}})),{type:"simple",target:i,attributeMapping:u,vvMapping:a}}function ft(e,i,t){if(!t||!t.length)return[];const s={storage:!0},r="numeric";return Ae(t).map(n=>{var o;const a=_e(n.type),{field:l,fieldIndex:u}=S(e,{target:i,valueExpression:n.valueExpression,field:n.field,context:s,resultType:r});switch(n.type){case"size":return n.valueExpression==="$view.scale"?null:{type:"size",binding:a,field:l,fieldIndex:u,normalizationField:S(e,{target:i,field:n.normalizationField,context:s,resultType:r}).field,valueRepresentation:(o=n.valueRepresentation)!=null?o:null};case"color":return{type:"color",binding:a,field:l,fieldIndex:u,normalizationField:S(e,{target:i,field:n.normalizationField,context:s,resultType:r}).field};case"opacity":return{type:"opacity",binding:a,field:l,fieldIndex:u,normalizationField:S(e,{target:i,field:n.normalizationField,context:s,resultType:r}).field};case"rotation":return{type:"rotation",binding:a,field:l,fieldIndex:u}}}).filter(n=>n)}function X(e,i,t,s=!1){const r=Ne(e,{indexCount:0,fields:{}});switch(t.type){case"simple":case"dot-density":return ct(r,t,s);case"class-breaks":return yt(r,i,t,s);case"unique-value":return mt(r,i,t,s);case"dictionary":return gt(r,t,s);case"heatmap":return bt(r,t,s);case"pie-chart":return dt(r,t,s)}}function ct(e,i,t=!1){const s=i.getSymbols(),r=s.length?s[0]:null,n=E(i);return{type:"simple",symbol:x(r,n,t),symbologyType:n.symbologyType}}function dt(e,i,t=!1){const s=i.getSymbols(),r=s[0],n=s.length>1?s[1]:null,a=E(i);return{type:"pie-chart",markerSymbol:x(r,a,t),fillSymbol:x(n,a,t),symbologyType:a.symbologyType}}function yt(e,i,t,s=!1){const r={mesh:!0,use:"renderer.field"},n=t.backgroundFillSymbol,{field:a,fieldIndex:l}=S(e,{target:i,field:t.field,valueExpression:t.valueExpression,resultType:"numeric",context:r}),u=t.normalizationType,o=u==="log"?"esriNormalizeByLog":u==="percent-of-total"?"esriNormalizeByPercentOfTotal":u==="field"?"esriNormalizeByField":null,p=E(t),m=t.classBreakInfos.map(f=>({symbol:x(f.symbol,p,s),min:f.minValue,max:f.maxValue})).sort((f,L)=>f.min-L.min);return{type:"interval",attributes:e.fields,field:a,fieldIndex:l,backgroundFillSymbol:x(n,p,s),defaultSymbol:x(t.defaultSymbol,p,s),intervals:m,normalizationField:t.normalizationField,normalizationTotal:t.normalizationTotal,normalizationType:o,isMaxInclusive:t.isMaxInclusive,symbologyType:p.symbologyType}}function mt(e,i,t,s=!1){const r=[],n=t.backgroundFillSymbol,a={target:i,context:{mesh:!0},resultType:"string"};if(t.field&&typeof t.field!="string")throw new d(b,"Expected renderer.field to be a string",t);const{field:l,fieldIndex:u}=S(e,h(v({},a),{field:t.field,valueExpression:t.valueExpression})),o=E(t);for(const p of t.uniqueValueInfos)r.push({value:""+p.value,symbol:x(p.symbol,o,s)});return{type:"map",attributes:e.fields,field:l,fieldIndex:u,field2:S(e,h(v({},a),{field:t.field2})).field,field3:S(e,h(v({},a),{field:t.field3})).field,fieldDelimiter:t.fieldDelimiter,backgroundFillSymbol:x(n,o),defaultSymbol:x(t.defaultSymbol,o),map:r,symbologyType:o.symbologyType}}function gt(e,i,t=!1){const s=E(i);return{type:"dictionary",config:i.config,fieldMap:i.fieldMap,scaleExpression:i.scaleExpression,url:i.url,symbolOptions:s,symbologyType:s.symbologyType}}function bt(e,i,t=!1){const s=i.getSymbols(),r=s.length?s[0]:null,n=E(i);return{type:"heatmap",symbol:x(r,n,t),symbologyType:n.symbologyType}}export{X as K,E as S,We as c,je as d,Ke as f,Mt as i,Qe as m,Ot as v,xe as x,Lt as z};
