var A=Object.defineProperty,B=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var E=(n,a,e)=>a in n?A(n,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[a]=e,M=(n,a)=>{for(var e in a||(a={}))j.call(a,e)&&E(n,e,a[e]);if(g)for(var e of g(a))k.call(a,e)&&E(n,e,a[e]);return n},$=(n,a)=>B(n,O(a));import{j as q,E as G,f$ as Y,aI as _,W as U,d8 as W,b4 as Z,g0 as H,g1 as J}from"./vendor.c414a8c9.js";import{O as K}from"./quantizationUtils.2450b4c7.js";import{T as L,s as Q,m as X,c as aa,V as na,g as ea,h as ia,y as ta,D as oa,z as la}from"./utils.791af34e.js";import"./ClassBreaksDefinition.4bef1fcf.js";let I=null;function sa(n,a,e){return n.x<0?n.x+=a:n.x>e&&(n.x-=a),n}function ra(n,a,e,o){const t=Y(e)?_(e):null,r=t?Math.round((t.valid[1]-t.valid[0])/a.scale[0]):null;return n.map(s=>{const i=new q(G(s.geometry));return K(a,i,i,i.hasZ,i.hasM),s.geometry=t?sa(i,r,o[0]):i,s})}function ua(n,a=18,e,o,t,r){const s=new Float64Array(t*r);a=Math.round(U(a));let i=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,u=0,m=0,d=0,f=0;const c=H(o,e);for(const{geometry:v,attributes:z}of n){const{x:y,y:w}=v,P=Math.max(0,y-a),b=Math.max(0,w-a),D=Math.min(r,w+a),N=Math.min(t,y+a),C=+c(z);for(let x=b;x<D;x++)for(let T=P;T<N;T++){const F=x*t+T,S=J(T-y,x-w,a),R=s[F];u=s[F]+=S*C;const V=u-R;m+=V,d+=V*V,u<i&&(i=u),u>l&&(l=u),f++}}if(!f)return{mean:0,stddev:0,min:0,max:0,mid:0,count:0};const p=(l-i)/2;return{mean:m/f,stdDev:Math.sqrt((d-m*m/f)/f),min:i,max:l,mid:p,count:f}}async function h(n,a){if(!a)return[];const e=n.field,o=n.valueExpression,t=n.normalizationType,r=n.normalizationField,s=n.normalizationTotal,i=[],l=n.viewInfoParams;let u=null,m=null;if(o){if(!I){const{arcadeUtils:c}=await W();I=c}u=I.createFunction(o),m=l&&I.getViewInfo({viewingMode:l.viewingMode,scale:l.scale,spatialReference:new Z(l.spatialReference)})}const d=n.fieldInfos,f=!(a[0]&&"declaredClass"in a[0]&&a[0].declaredClass==="esri.Graphic")&&d?{fields:d}:null;return a.forEach(c=>{const p=c.attributes;let v;if(o){const z=f?$(M({},c),{layer:f}):c,y=I.createExecContext(z,m);v=I.executeFunction(u,y)}else p&&(v=p[e]);if(t&&isFinite(v)){const z=p&&parseFloat(p[r]);v=L(v,t,z,s)}i.push(v)}),i}async function va(n){const{attribute:a,features:e}=n,{normalizationType:o,normalizationField:t,minValue:r,maxValue:s,fieldType:i}=a,l=await h({field:a.field,valueExpression:a.valueExpression,normalizationType:o,normalizationField:t,normalizationTotal:a.normalizationTotal,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e),u=Q({normalizationType:o,normalizationField:t,minValue:r,maxValue:s}),m={value:.5,fieldType:i},d=i==="esriFieldTypeString"?X({values:l,supportsNullCount:u,percentileParams:m}):aa({values:l,minValue:r,maxValue:s,useSampleStdDev:!o,supportsNullCount:u,percentileParams:m});return na(d,i==="esriFieldTypeDate")}async function Ia(n){const{attribute:a,features:e}=n,o=await h({field:a.field,valueExpression:a.valueExpression,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e),t=ea(o);return ia(t,a.domain,a.returnAllCodedValues)}async function za(n){const{attribute:a,features:e}=n,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:s,classificationMethod:i}=a,l=await h({field:o,valueExpression:a.valueExpression,normalizationType:t,normalizationField:r,normalizationTotal:s,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e),u=ta(l,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:s,classificationMethod:i,standardDeviationInterval:a.standardDeviationInterval,numClasses:a.numClasses,minValue:a.minValue,maxValue:a.maxValue});return oa(u,i)}async function ya(n){const{attribute:a,features:e}=n,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:s,classificationMethod:i}=a,l=await h({field:o,valueExpression:a.valueExpression,normalizationType:t,normalizationField:r,normalizationTotal:s,viewInfoParams:a.viewInfoParams,fieldInfos:a.fieldInfos},e);return la(l,{field:o,normalizationType:t,normalizationField:r,normalizationTotal:s,classificationMethod:i,standardDeviationInterval:a.standardDeviationInterval,numBins:a.numBins,minValue:a.minValue,maxValue:a.maxValue})}async function xa(n){const{attribute:a,features:e}=n,{field:o,radius:t,fieldOffset:r,transform:s,spatialReference:i,size:l}=a,u=ra(e,s,i,l),{count:m,min:d,max:f,mean:c,stdDev:p}=ua(u,t,r,o,l[0],l[1]);return{count:m,min:d,max:f,avg:c,stddev:p}}export{za as classBreaks,xa as heatmapStatistics,ya as histogram,va as summaryStatistics,Ia as uniqueValues};
